const META_ATTRIBUTE_NAME = 'ag-environment-config';

export const encode = (config = {}) =>
  encodeURIComponent(JSON.stringify(config));

export const decode = (content) =>
  JSON.parse(decodeURIComponent(content));

export const metaTagForInjection = (config) => {
  const content = encode(config);
  return `<meta name="${META_ATTRIBUTE_NAME}" content="${content}" />`;
};

export const extractConfig = () => {
  const meta = document.querySelector(`meta[name='${META_ATTRIBUTE_NAME}']`);
  if (meta) {
    return decode(meta.getAttribute('content'));
  }
  return { error: 'config not found' };
};
