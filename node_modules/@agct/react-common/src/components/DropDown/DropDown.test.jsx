import React from 'react';
import chai, { expect } from 'chai';
import { mount } from 'enzyme';
import chaiEnzyme from 'chai-enzyme';

chai.use(chaiEnzyme());

import DropDown from './DropDown';

describe('Dropdown Component', () => {
  it('should render when no options are presented', () => {
    const actions = { onClick() {}, onFocus() {}, onChange() {} };
    const wrapper = mount(<DropDown onChange={actions.onChange} onFocus={actions.onFocus} />);
    const dropdown = wrapper.find('.dropdown');
    expect(dropdown.childAt(0)).to.have.className('btn');
    expect(dropdown.childAt(0)).to.have.className('dropdown__toggle');
    expect(dropdown.childAt(1)).to.have.className('dropdown__options');
    expect(wrapper.find('.dropdown__title')).to.have.text('Please select a value');
  });
});

describe('Dropdown Actions', () => {
  const actions = { onClick() {}, onFocus() {}, onChange() {} };
  const dropdownItems =
    [
      { value: 'GBP', label: 'Pounds', disabled: true },
      { value: 'USD', label: 'Dollars' },
    ];

  const wrapper = mount(
    <DropDown handleToggle={actions.onClick}
      onChange={actions.onChange} onFocus={actions.onFocus}
      items={dropdownItems}
    />);

  it('should toggle open/close when clicked', () => {
    const dropdownBtn = wrapper.find('.btn');
    expect(wrapper.find('.dropdown__options')).to.not.have.className('is-open');
    dropdownBtn.simulate('click');
    expect(wrapper.find('.dropdown__options')).to.have.className('is-open');
    dropdownBtn.simulate('click');
    expect(wrapper.find('.dropdown__options')).to.not.have.className('is-open');
  });

  it('should not toggle open when clicked if dropdown disabled', () => {
    const disabledDropDown = mount(
      <DropDown handleToggle={actions.onClick}
        onChange={actions.onChange} onFocus={actions.onFocus}
        items={dropdownItems} isDisabled
      />);
    const dropdownBtn = disabledDropDown.find('.btn');
    expect(wrapper.find('.dropdown__options')).to.not.have.className('is-open');
    dropdownBtn.simulate('click');
    expect(wrapper.find('.dropdown__options')).to.not.have.className('is-open');
  });

  it('should list options passed through to it', () => {
    const listOptions = wrapper.find('.dropdown__options');
    expect(listOptions.children()).to.have.length(dropdownItems.length + 1);
    expect(listOptions.childAt(0)).to.have.text('--');
    expect(listOptions.childAt(1)).to.have.text('Pounds');
    expect(listOptions.childAt(1)).to.have.className('dropdown__options__option');
    expect(listOptions.childAt(1)).to.have.className('is-disabled');
    expect(listOptions.childAt(2)).to.have.text('Dollars');
    expect(listOptions.childAt(2)).to.have.className('dropdown__options__option');
    expect(listOptions.childAt(2)).to.not.have.className('is-disabled');
  });
});
