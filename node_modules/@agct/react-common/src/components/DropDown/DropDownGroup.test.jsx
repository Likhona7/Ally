import React from 'react';
import chai, { expect } from 'chai';
import { mount } from 'enzyme';

import chaiEnzyme from 'chai-enzyme';

chai.use(chaiEnzyme());

import DropDown from './DropDownGroup';

describe('Dropdown Component', () => {
  it('should render when no options are presented', () => {
    const actions = { onClick() {}, onFocus() {}, onChange() {} };
    const wrapper = mount(<DropDown onChange={actions.onChange} onFocus={actions.onFocus} />);
    const dropdown = wrapper.find('.dropdown');
    expect(dropdown.childAt(0)).to.have.className('btn');
    expect(dropdown.childAt(0)).to.have.className('dropdown__toggle');
    expect(dropdown.childAt(1)).to.have.className('dropdown__options');
    expect(wrapper.find('.dropdown__title')).to.have.text('Please select a value');
  });
});

describe('Dropdown Actions', () => {
  const actions = { onClick() {}, onFocus() {}, onChange() {} };
  const dropdownItems =
    [
      {
        label: 'Currency',
        items: [
          { value: 'GBP', label: 'Pounds', disabled: true },
          { value: 'EUR', label: 'Euro' },
        ],
      },
      {
        label: 'Colours',
        items: [
          { value: 'RED', label: 'red', disabled: true },
          { value: 'GREEN', label: 'green' },
          { value: 'BLUE', label: 'blue' },
          { value: 'ORANGE', label: 'orange' },
        ],
      },
      {
        label: 'Cars',
        items: [
          { value: 'MERC', label: 'Merc', disabled: true },
          { value: 'BMW', label: 'BMW' },
          { value: 'AUDI', label: 'Audi' },
        ],
      },
    ];

  const wrapper = mount(
    <DropDown handleToggle={actions.onClick}
      onChange={actions.onChange} onFocus={actions.onFocus}
      groups={dropdownItems}
    />);

  it('should toggle open/close when clicked', () => {
    const dropdownBtn = wrapper.find('.btn');
    expect(wrapper.find('.dropdown__options')).to.not.have.className('is-open');
    dropdownBtn.simulate('click');
    expect(wrapper.find('.dropdown__options')).to.have.className('is-open');
    dropdownBtn.simulate('click');
    expect(wrapper.find('.dropdown__options')).to.not.have.className('is-open');
  });

  it('should list options passed through to it', () => {
    const listOptions = wrapper.find('.dropdown__options');
    expect(listOptions.children()).to.have.length(dropdownItems.length + 1);
    expect(listOptions.childAt(0)).to.have.className('dropdown__options__option');
    expect(listOptions.childAt(0)).to.have.text('--');

    let currentGroup = listOptions.childAt(1);
    expect(currentGroup.children()).to.have.length(dropdownItems[0].items.length + 1);
    let currentGroupOption = currentGroup.childAt(0);
    expect(currentGroupOption).to.have.className('dropdown__options__group');
    expect(currentGroupOption).to.have.text('Currency');
    currentGroupOption = currentGroup.childAt(1).find('.dropdown__options__option');
    expect(currentGroupOption).to.have.className('is-disabled');
    expect(currentGroupOption).to.have.text('Pounds');

    currentGroup = listOptions.childAt(3);
    expect(currentGroup.children()).to.have.length(dropdownItems[2].items.length + 1);
    currentGroupOption = currentGroup.childAt(0);
    expect(currentGroupOption).to.have.className('dropdown__options__group');
    expect(currentGroupOption).to.have.text('Cars');
    currentGroupOption = currentGroup.childAt(2).find('.dropdown__options__option');
    expect(currentGroupOption).to.not.have.className('is-disabled');
    expect(currentGroupOption).to.have.text('BMW');
  });
});
